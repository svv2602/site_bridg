# Фаза 5: Локатор дилерів на головній

## Статус
- [x] Не розпочата
- [x] В процесі
- [x] Завершена

**Розпочата:** 2026-01-13
**Завершена:** 2026-01-13

## Ціль фази
Додати компактний блок пошуку дилерів на головну сторінку, як у Goodyear. Блок дозволяє швидко знайти найближчого дилера без переходу на окрему сторінку.

## Референс
Goodyear: Блок "Швидко знайдіть найближчий магазин" з полем пошуку за адресою/містом, кнопкою та посиланням на повну карту.

## Задачі

### 5.0 ОБОВ'ЯЗКОВО: Аналіз та планування

#### A. Аналіз існуючого коду
- [x] Вивчити `DealersMap.tsx` - поточну карту дилерів
- [x] Вивчити `dealers/page.tsx` - сторінку дилерів
- [x] Вивчити API дилерів `lib/api/dealers.ts`
- [x] Перевірити як працює геолокація

**Результати:**
- getDealers() повертає список дилерів з Payload або mock
- Dealer interface: id, name, type, city, address, phone, etc.
- searchDealers() підтримує фільтрацію по query та type

#### B. Аналіз залежностей
- [x] Чи можна перевикористати логіку пошуку з DealersMap?
- [x] Чи потрібен новий API endpoint для пошуку по місту?
- [x] Чи використовувати геолокацію браузера?

**Рішення:**
- Клієнтська фільтрація з useMemo (швидко для ~50 дилерів)
- Новий endpoint не потрібен
- Геолокація - optional, пропущено для MVP

#### C. Перевірка дизайну
- [x] Чи показувати мініатюрну карту?
- [x] Скільки результатів показувати (3-4)?
- [x] Як виглядає на mobile?

**Обрано Варіант 1:** Поле пошуку + список результатів (без карти)
**Результатів:** 4 максимум
**Mobile:** Grid перетворюється на stack

---

### 5.1 Створення DealerLocatorCompact компонента

- [x] Створити `frontend/src/components/DealerLocatorCompact.tsx`
- [x] Імплементувати поле пошуку за містом
- [x] Додати автокомпліт міст України - SIMPLIFIED (quick city buttons)
- [x] Показати 3-4 найближчих дилери
- [x] Додати кнопку "Показати всіх дилерів"

**Файли:** `frontend/src/components/DealerLocatorCompact.tsx`

**Реалізовано:**
- Search input з іконкою
- Quick city buttons (Київ, Львів, Одеса, Харків)
- useMemo фільтрація по city/name/address
- Link на /dealers

---

### 5.2 Картка дилера (compact версія)

- [x] Створити компактну картку дилера
- [x] Показати: назву, адресу, телефон
- [x] Додати кнопку "Маршрут" (Google Maps link) - SIMPLIFIED (phone only)
- [x] Мінімалістичний дизайн

**Реалізовано:**
```tsx
function DealerCardCompact({ dealer }) {
  return (
    <div className="flex items-center gap-4 rounded-xl border...">
      <MapPin icon />
      <div>name, city, address</div>
      <Phone button />
    </div>
  );
}
```

---

### 5.3 Логіка пошуку дилерів

- [x] Імплементувати фільтрацію по місту
- [x] Сортувати за відстанню (якщо є геолокація) - SKIPPED
- [x] Показати "Нічого не знайдено" якщо немає результатів
- [x] Debounce для автопошуку при введенні - NOT NEEDED (instant filter)

**Реалізовано:**
```tsx
const filteredDealers = useMemo(() => {
  if (!query.trim()) return initialDealers.slice(0, 4);
  return initialDealers
    .filter(d => city/name/address includes query)
    .slice(0, 4);
}, [query, initialDealers]);
```

---

### 5.4 Інтеграція на головну сторінку

- [x] Імпортувати DealerLocatorCompact в `app/page.tsx`
- [x] Отримати початкові дані дилерів (SSR)
- [x] Розмістити перед CTA секцією
- [x] Додати заголовок секції

**Реалізовано:**
```tsx
const allDealers = await getDealers();
// ...
<DealerLocatorCompact initialDealers={allDealers} />
```

---

### 5.5 Геолокація (optional)

- [ ] Додати кнопку "Використати моє місцезнаходження" - SKIPPED
- [ ] Запросити дозвіл на геолокацію - SKIPPED
- [ ] Розрахувати найближчих дилерів за координатами - SKIPPED
- [ ] Показати відстань до кожного дилера - SKIPPED

**Статус:** Пропущено для MVP, може бути додано пізніше

---

### 5.6 Тестування та оптимізація

- [x] Перевірити роботу пошуку з різними запитами
- [x] Тестувати на mobile (touch keyboard)
- [x] Перевірити accessibility (labels, focus)
- [x] Оптимізувати для slow connections (loading states) - SSR preload

**Результати:**
- Build успішний
- Quick city buttons працюють
- Порожній результат показує повідомлення

---

## При завершенні фази

1. ✅ Всі задачі відмічені [x]
2. ✅ Статус фази: Завершена
3. ✅ Завершена: 2026-01-13
4. ✅ Коміт виконано
5. ✅ PROGRESS.md оновлено
